# 🤖 多智能体异步协同系统

本文档介绍两种多智能体协同方法：**asyncio协同** 和 **LangGraph工作流**。

---

## 📁 文件说明

### 1. `multi_agent_async.py` - 基于asyncio的并行协同

**适用场景**：
- ✅ 需要并行执行独立任务
- ✅ 任务之间依赖关系简单
- ✅ 追求最大并发性能

**特点**：
```python
# 并行执行多个任务
search_tasks = [
    agent1.ainvoke(task1),  # 同时执行
    agent2.ainvoke(task2),  # 同时执行
    agent3.ainvoke(task3),  # 同时执行
]
results = await asyncio.gather(*search_tasks)
```

**架构**：
```
研究团队
├── 搜索专家-1 ──┐
├── 搜索专家-2 ──┼── 并行执行 ──> 总结专家 ──> 最终报告
└── 数据分析师 ──┘
```

**优势**：
- 🚀 最快的执行速度（真正的并行）
- 💡 代码简单直观
- 🔧 灵活的任务组合

---

### 2. `multi_agent_langgraph.py` - 基于LangGraph的工作流

**适用场景**：
- ✅ 复杂的工作流编排
- ✅ 任务之间有明确的依赖关系
- ✅ 需要条件分支和循环
- ✅ 需要可视化工作流

**特点**：
```python
# 定义工作流图
workflow = StateGraph(State)
workflow.add_node("reporter", reporter_node)
workflow.add_node("editor", editor_node)
workflow.add_node("publisher", publisher_node)

# 定义执行顺序
workflow.set_entry_point("reporter")
workflow.add_edge("reporter", "editor")
workflow.add_edge("editor", "publisher")
```

**架构**：
```
新闻工作流
记者 ──> 编辑 ──> 发布者 ──> 最终报告
(搜索)   (审核)   (格式化)
```

**优势**：
- 📊 可视化工作流
- 🔄 支持复杂的条件分支
- 💾 状态管理更清晰
- 🛠️ 易于调试和维护

---

## 🆚 对比分析

| 特性 | asyncio协同 | LangGraph工作流 |
|-----|------------|----------------|
| **执行方式** | 真正的并行 | 顺序流转 |
| **性能** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **复杂度** | 简单 | 中等 |
| **可视化** | ❌ | ✅ |
| **状态管理** | 手动 | 自动 |
| **条件分支** | 需要自己实现 | 内置支持 |
| **适用规模** | 小到中型 | 中到大型 |

---

## 🚀 快速开始

### 安装依赖

```bash
# 如果还没安装LangGraph
pip install langgraph
```

### 运行示例

#### 方法1：并行协同（更快）
```bash
python chapter08-A2A/multi_agent_async.py
```

**输出**：
```
D:\Anaconda\envs\tellme\python.exe D:\Garfield_Lyu\postgraduate\project\langchain\chapter08-A2A\multi_agent_async.py 

================================================================================
 🤖 [系统] 多智能体异步协同研究系统
================================================================================

🚀 正在初始化研究团队...
✅ 研究团队初始化完成


================================================================================
🎯 [启动] 研究团队开始工作 - 主题: AI在医疗中的应用
================================================================================

📋 [阶段1] 并行信息搜索
--------------------------------------------------------------------------------

🔍 [搜索专家-1] 开始搜索: 搜索关于'AI在医疗中的应用'的最新信息和发展动态

🔍 [搜索专家-2] 开始搜索: 搜索关于'AI在医疗中的应用'的技术细节、应用案例和实践经验

📊 [数据分析师] 开始分析: 分析'AI在医疗中的应用'相关的数据趋势、市场规模和发展前景
✅ [搜索专家-1] 搜索完成 (耗时: 10.77s)
✅ [数据分析师] 分析完成 (耗时: 11.88s)
✅ [搜索专家-2] 搜索完成 (耗时: 20.58s)

================================================================================
📋 [阶段2] 整合分析结果
--------------------------------------------------------------------------------

📝 [总结专家] 开始整合结果...
✅ [总结专家] 整合完成 (耗时: 12.54s)

================================================================================
📊 [统计] 研究完成统计
================================================================================
⏱️  总耗时: 33.12秒
👥 参与智能体: 4个
✅ 成功任务: 3/3
📝 执行任务数: 4个

各智能体耗时：
  ✅ 搜索专家-1: 10.77s
  ✅ 搜索专家-2: 20.58s
  ✅ 数据分析师: 11.88s
  ✅ 总结专家: 12.54s

================================================================================


================================================================================
📄 [报告] 最终研究报告
================================================================================
# AI在医疗中的应用研究报告

## 执行摘要
本报告探讨了人工智能（AI）在医疗领域的应用现状、技术细节及市场发展趋势。AI技术的广泛应用正在推动医疗行业的变革，提升医疗服务的效率和质量。预计到2025年，医疗AI市场规模将达到数百亿美元，年均增长率超过40%。随着技术的进步，AI将在疾病诊断、个性化治疗和健康管理等方面发挥更大作用。

## 关键发现
1. **市场增长迅速**：预计到2025年，全球医疗AI市场将达到数百亿美元，年均增长率超过40%。
2. **技术应用广泛**：AI在医学影像、药物研发和慢病管理等领域展现出巨大潜力。
3. **深度学习与云计算**：深度学习和云计算技术正在加速医疗行业的数字化转型。
4. **提高诊断效率**：AI技术在医学影像分析中能够显著提高疾病的早期诊断率。
5. **个性化医疗**：AI推动个性化治疗的发展，通过数据分析提供精准的健康干预。

## 详细分析
AI技术在医疗中的应用正在快速发展，主要体现在以下几个方面：

### 1. 市场规模与增长趋势
根据数据分析，全球医疗AI市场预计将在2025年前达到数百亿美元，年均增长率超过40%。这一增长主要得益于AI在疾病诊断、个性化治疗和药物研发等领域的广泛应用。随着医疗数据的不断积累，AI技术的应用将更加深入，推动传统医疗模式的变革。

### 2. 技术细节与应用案例
AI技术主要包括机器学习、深度学习和神经网络，这些技术能够通过分析大量医疗数据来优化治疗选择和预测患者反应。例如，AI在医学影像分析中的应用，能够高精度识别X光片、CT和MRI中的微小变化，帮助医生早期发现疾病。此外，AI还在慢病管理和远程医疗中发挥着重要作用，提供个性化健康干预。

### 3. 未来展望
随着云计算和深度学习技术的不断进步，AI将在医疗决策支持、患者监测和健康管理等方面发挥更大作用。行业专家预计，AI将继续改善医疗结果，提高患者的治疗体验。

## 结论和建议
AI在医疗领域的应用正在推动行业的技术变革，提升医疗服务的效率和质量。建议医疗机构加大对AI技术的投资，积极探索AI在临床决策支持和个性化治疗中的应用。同时，关注数据隐私和伦理问题，确保技术应用的安全性和有效性。未来，随着技术的不断发展，AI将在医疗行业中扮演更加重要的角色。

================================================================================


================================================================================
💬 进入交互模式（输入'exit'或'退出'结束）
================================================================================

🔎 请输入研究主题: exit

👋 再见！感谢使用多智能体研究系统


🛑 系统正在关闭...


进程已结束，退出代码为 0

```

#### 方法2：工作流编排（更结构化）
```bash
python chapter08-A2A/multi_agent_langgraph.py
```

**示例输出**：
```
🚀 新闻工作流启动 - 主题: 人工智能最新突破
================================================================================

📰 [记者] 开始搜索新闻: 人工智能最新突破
✅ [记者] 新闻搜索完成

✏️ [编辑] 开始审核内容
✅ [编辑] 内容审核完成

📢 [发布者] 生成最终报告
✅ [发布者] 报告生成完成

================================================================================
✅ 工作流完成
================================================================================
```

---

## 💡 选择建议

### 使用 `asyncio协同` 如果你需要：
- ⚡ 最快的执行速度
- 🔀 多个独立任务同时执行
- 📊 简单的结果聚合

**示例场景**：
- 同时搜索多个数据源
- 并行处理多个文档
- 批量API调用

### 使用 `LangGraph工作流` 如果你需要：
- 📋 复杂的业务流程
- 🔄 条件分支和循环
- 👀 工作流可视化
- 🛠️ 易于维护的代码

**示例场景**：
- 多步骤审批流程
- 内容创作管道
- 复杂的决策树

---

## 🎯 实际应用案例

### 案例1：新闻聚合系统（asyncio）
```python
# 同时从多个新闻源获取信息
sources = [
    agent1.ainvoke("搜索CNN新闻"),
    agent2.ainvoke("搜索BBC新闻"),
    agent3.ainvoke("搜索路透社新闻"),
]
results = await asyncio.gather(*sources)
summary = await summarizer.ainvoke(results)
```

### 案例2：文档审核系统（LangGraph）
```python
# 文档经过多个审核环节
文档 -> 初审 -> 技术审核 -> 法务审核 -> 最终批准
       ↓        ↓           ↓
      拒绝     返回修改    返回修改
```

---

## 🔧 扩展建议

### 1. 添加重试机制
```python
async def ainvoke_with_retry(self, task: str, max_retries=3):
    for attempt in range(max_retries):
        try:
            return await self.ainvoke(task)
        except Exception as e:
            if attempt == max_retries - 1:
                raise
            await asyncio.sleep(2 ** attempt)
```

### 2. 添加超时控制
```python
result = await asyncio.wait_for(
    agent.ainvoke(task),
    timeout=30.0  # 30秒超时
)
```

### 3. 添加进度监控
```python
from tqdm.asyncio import tqdm

results = []
for task in tqdm(tasks, desc="执行任务"):
    result = await task
    results.append(result)
```

---

## 📚 参考资料

- [LangGraph文档](https://langchain-ai.github.io/langgraph/)
- [Python asyncio官方文档](https://docs.python.org/3/library/asyncio.html)
- [LangChain Agent文档](https://python.langchain.com/docs/modules/agents/)

---

## ⚠️ 注意事项

1. **API限流**：并行调用时注意API的速率限制
2. **资源消耗**：过多并发可能导致内存/CPU问题
3. **错误处理**：并行任务中一个失败不应影响其他任务
4. **成本控制**：LLM API调用是按token收费的

---

## 🎓 学习路径

1. **入门**：先学习 `googleSearch.py` - 单智能体基础
2. **进阶**：学习 `multi_agent_async.py` - 并行协同
3. **高级**：学习 `multi_agent_langgraph.py` - 工作流编排
4. **实战**：根据实际需求选择合适的方案

---

## 📝 TODO

- [ ] 添加更多工具（数据库查询、文件操作等）
- [ ] 实现智能体之间的消息传递
- [ ] 添加工作流可视化
- [ ] 实现人工介入机制
- [ ] 添加性能监控和日志

---

**作者**: lgf  
**日期**: 2025/10/31  
**环境**: conda环境tellme